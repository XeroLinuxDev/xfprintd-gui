# Maintainer: Kristián Kekeš <gamerix2006@gmail.com>
# Maintainer: Steve C. <steve@techxero.com>

pkgname=xfprintd-gui
pkgver=0.1.0
pkgrel=1
pkgdesc="GTK4 GUI to manage fingerprint enrollment and PAM integration"
arch=('x86_64')
url="https://github.com/BananikXenos/xfprintd-gui"
license=('GPL-3.0-or-later')
depends=(
    'gtk4'
    'polkit'
    'glib2'
    'fprintd'
)
makedepends=(
    'rust'
    'cargo'
    'pkgconf'
)
provides=('xfprintd-gui')
conflicts=('xfprintd-gui')
options=('!emptydirs')

build() {
  cd "${startdir}/.."

  # Build both GUI and helper tool using workspace
  cargo build --release --locked
}

package() {
  cd "${startdir}/.."

  # Install binaries into /opt/xfprintd-gui
  install -d "${pkgdir}/opt/xfprintd-gui"
  install -Dm755 "target/release/xfprintd-gui" \
    "${pkgdir}/opt/xfprintd-gui/xfprintd-gui"
  install -Dm755 "target/release/xfprintd-gui-helper" \
    "${pkgdir}/opt/xfprintd-gui/xfprintd-gui-helper"

  # Install patches directory
  cp -r "helper_tool/patches" "${pkgdir}/opt/xfprintd-gui/"

  # Convenience symlink in /usr/bin
  install -d "${pkgdir}/usr/bin"
  ln -s "/opt/xfprintd-gui/xfprintd-gui" "${pkgdir}/usr/bin/xfprintd-gui"

  # Install desktop file
  install -Dm644 "packaging/xfprintd-gui.desktop" \
    "${pkgdir}/usr/share/applications/xfprintd-gui.desktop"

  # Install icon
  install -Dm644 "gui/resources/icons/scalable/apps/fingerprint.svg" \
    "${pkgdir}/usr/share/icons/hicolor/scalable/apps/xfprintd-gui.svg"
}

post_install() {
  gtk-update-icon-cache -q -t -f usr/share/icons/hicolor
}

post_upgrade() {
  post_install
}

post_remove() {
  gtk-update-icon-cache -q -t -f usr/share/icons/hicolor
}
